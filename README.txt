Digital Controller Design for an Inverted Pendulum on a Cart System

## Overview

This project involves the design, simulation, and comparison of two digital control strategies (PID and LQR with Kalman Filter) for stabilizing an inverted pendulum on a cart system. The implementation is done using MATLAB for the ME5422 Computer Control and Applications course at the National University of Singapore.

The simulation includes practical considerations such as sensor noise, sensor range limits, and actuator saturation.

## Folder Structure and File Descriptions

. ├── figures/ # Folder containing generated plot images (.png, .jpg) │ ├── ... (various plot files) ├── controller_gains.mat # Stores calculated LQR gain (K) and Kalman gain (L), Rn ├── generate_analysis_plots.m # MATLAB script to generate frequency-domain plots (Bode, Nyquist) for analysis ├── lqr_controller.m # MATLAB script to calculate LQR and Kalman gains (using DARE) and save them ├── model.m # MATLAB script to define system parameters, derive state-space model, discretize it, and save ├── pid_controller.m # (Note: Contains PID logic snippet, actual implementation is within simulation.m) ├── simulation.m # Main MATLAB script to run closed-loop simulations for PID or LQR ├── system_model.mat # Stores discretized system matrices (Ad, Bd, Cd, Dd) and Ts ├── ME5422 Project Report_Cai Yunchen.pdf # The final project report document └── README.md # This file


**File Details:**

* **`model.m`**: Defines system physical parameters ($m_c, m_p, L, g$), derives the continuous-time state-space model ($A, B, C, D$), discretizes it using ZOH ($A_d, B_d, C_d, D_d$) with $T_s=0.01$s, and saves the discrete model to `system_model.mat`.
* **`system_model.mat`**: Contains the discrete-time state-space matrices (`Ad`, `Bd`, `Cd`, `Dd`) and the sampling time (`Ts`). Generated by `model.m`.
* **`lqr_controller.m`**: Calculates the LQR state feedback gain `K` using `dlqr` based on chosen $Q$ and $R$ matrices. Calculates the steady-state Kalman filter gain `L` using the `dare` function based on chosen $Q_n$ and $R_n$. Saves `K`, `L`, and `Rn` to `controller_gains.mat`.
* **`controller_gains.mat`**: Contains the LQR gain matrix `K`, the Kalman gain matrix `L`, and the measurement noise covariance `Rn`. Generated by `lqr_controller.m`.
* **`simulation.m`**: The main simulation script.
    * Loads the system model (`system_model.mat`).
    * Allows selection between `'PID'` and `'LQR'` controllers via the `controller_type` variable.
    * If LQR, loads gains from `controller_gains.mat`.
    * If PID, defines the cascade PD-PD gains (including the derivative filter parameters).
    * Runs a discrete-time simulation loop implementing the chosen controller logic (including PID filtering and anti-windup, or LQR state feedback with Kalman estimation).
    * Simulates measurement noise, sensor limits, and actuator saturation.
    * Logs state, input, and measurement data.
    * Generates time-domain plots (x, theta, f vs. time) and state estimation plots (for LQR).
* **`generate_analysis_plots.m`**: Loads the system model and final controller parameters (LQR gains from file, PID gains defined within). Generates frequency-domain analysis plots (Bode, Nyquist) for the final LQR controller (using `loopsens` or fallback) and the simplified inner-loop PD controller. Saves the generated figures.
* **`figures/`**: A directory containing the `.png` or `.jpg` image files of the plots generated by `simulation.m` and `generate_analysis_plots.m`, intended for inclusion in the report.
* **`ME5422 Project Report_Cai Yunchen.pdf`**: The final PDF report documenting the project design, results, and analysis.
* **`pid_controller.m`**: Contains a snippet of the PID control logic, but the full implementation is integrated within `simulation.m`. This file is not run directly.

*(Files like `.asv` are MATLAB auto-save files and can generally be ignored.)*

## How to Run

1.  **Prerequisites:**
    * MATLAB installed.
    * MATLAB Control System Toolbox installed.
2.  **Setup:**
    * Place all the `.m` files and `.mat` files in the same directory.
    * Ensure the `figures` directory exists (or create it) if you want plots saved there automatically by the analysis script (or modify save paths).
    * Open MATLAB and navigate to this directory (set it as the "Current Folder").
3.  **Generate System Model:**
    * Run `model.m` in the MATLAB Command Window:
        ```matlab
        >> model
        ```
    * This will create/update `system_model.mat`.
4.  **Generate LQR/Kalman Gains:**
    * Run `lqr_controller.m`:
        ```matlab
        >> lqr_controller
        ```
    * This will create/update `controller_gains.mat` using the final LQR tuning ($Q = \text{diag}([10, 10, 1, 10])$) and the DARE method for `L`.
5.  **Run Simulations:**
    * Open `simulation.m`.
    * Set the `controller_type` variable to either `'LQR'` or `'PID'` to choose which controller to simulate.
    * If simulating PID, ensure the final tuned PID parameters are correctly set within the `else` block (e.g., `Kp_theta = -20; Ki_theta = 0; Kd_theta = -2; alpha = 0.8; Kp_x = -0.5; Kd_x = -0.5;`).
    * Run `simulation.m`:
        ```matlab
        >> simulation
        ```
    * This will generate the time-domain response plots for the selected controller.
6.  **Generate Analysis Plots (Optional):**
    * Run `generate_analysis_plots.m`:
        ```matlab
        >> generate_analysis_plots
        ```
    * This will generate frequency-domain plots (Bode, Nyquist) for the final controllers and save them as PNG files. Note the warnings regarding the analysis methods used (simplified PID, fallback LQR).

## Dependencies

* MATLAB (tested on version R20XXx - specify your version if known)
* MATLAB Control System Toolbox

## Author

* Yunchen Cai (A0319397M)